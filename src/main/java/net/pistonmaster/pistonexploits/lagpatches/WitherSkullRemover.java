package net.pistonmaster.pistonexploits.lagpatches;

import net.pistonmaster.pistonexploits.PistonExploits;
import org.bukkit.entity.Entity;
import org.bukkit.entity.EntityType;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.world.ChunkUnloadEvent;

/**
 * Wither skulls = lag on load of the chunk. We just remove them when the chunk is unloading so
 * people don't wait for their chunk to load long.
 */
public class WitherSkullRemover implements Listener {
  private final PistonExploits plugin;

  public WitherSkullRemover(PistonExploits plugin) {
      this.plugin = plugin;
  }

  @EventHandler(priority = EventPriority.LOW)
  public void onChunkLoad(ChunkUnloadEvent event) {
    int witherSkulls = 0;

    for (Entity entity : event.getChunk().getEntities()) {
      if (entity.getType() == EntityType.WITHER_SKULL) {
        if (witherSkulls > 50) {
          entity.remove();
        } else {
          witherSkulls++;
        }
      }
    }
  }
}
